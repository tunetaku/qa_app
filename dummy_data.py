import sqlite3
from datetime import datetime, timedelta
from db_init import init_db

def generate_dummy_data():
    """Generate dummy plant engineering QA data"""
    try:
        init_db()
        conn = sqlite3.connect('qa_app.db')
        c = conn.cursor()
        
        # Clear existing data
        c.execute('DELETE FROM answers')
        c.execute('DELETE FROM questions')
        c.execute('DELETE FROM users')
        
        # ユーザーデータ (5人)
        users = [
            ('10000001', '田中 技術士', datetime.now()),
            ('10000002', '佐藤 主任', datetime.now()),
            ('10000003', '鈴木 ベテラン', datetime.now()),
            ('10000004', '山本 設計士', datetime.now()),
            ('10000005', '高橋 エンジニア', datetime.now()),
            ('10000006', '伊藤 新人', datetime.now()),
            ('10000007', '渡辺 技師長', datetime.now()),
            ('10000008', '中村 コンサルタント', datetime.now()),
            ('10000009', '小林 プロマネ', datetime.now()),
            ('10000010', '加藤 現場監督', datetime.now()),
            ('12345678', '山本', datetime.now())
        ]
        c.executemany('INSERT OR IGNORE INTO users VALUES (?, ?, ?)', users)
        
        # 質問データ (10件)
        questions = [
            (10000001, 'コンベヤ設計のポイント', 'コンベヤの設計で、ベルトの張力計算や荷重の均等分散をどう評価すればよいか悩んでいます。特に、稼働中の振動や偏摩耗を抑えるための設計対策は何でしょうか？', '設計,コンベヤ,振動', '2024-01-10'),
            (10000002, '除塵機の設置と空気流量計算', '除塵機の設置にあたって、対象エリアの粉塵発生量を見積もるとともに、最適な空気流量を確保するための設計ポイントは何でしょうか？', '除塵機,空気流量,設計', '2024-01-15'),
            (10000003, 'フライト式汚泥かき寄せ機の設計最適化', 'フライト式汚泥かき寄せ機を設置する際、かき寄せ効率を最大化するために、フライトの角度やピッチ、使用材料の選定など、どのパラメータに注力すれば良いでしょうか？', '汚泥,かき寄せ機,設計', '2024-01-20'),
            (10000004, '高温高圧配管の熱膨張対策', '高温高圧条件下での配管設計で、熱膨張や応力集中を防ぐために、どのような設計上の対策を講じればよいのでしょうか？', '配管,熱膨張,設計', '2024-02-05'),
            (10000005, '点検架台（作業プラットフォーム）の安全設計', '点検架台の設計で、作業者が安全かつ効率的に点検作業できるよう、荷重計算や安全装置の配置など、どのような点に留意すべきでしょうか？', '点検架台,安全設計,荷重', '2024-02-10'),
            (10000006, '大型機械用基礎工事の振動吸収設計', '大型設備の設置に伴う基礎工事で、地盤との一体化を図るとともに、振動や衝撃を吸収するための具体的な設計手法は何でしょうか？', '基礎工事,振動,設計', '2024-02-15'),
            (10000007, '防食塗装施工管理の工程と品質チェック', '防食塗装の工程管理において、表面前処理や塗膜の厚さ管理、環境条件の管理はどのように行えば良いのでしょうか？', '防食塗装,品質管理,施工', '2024-03-01'),
            (10000008, '複数設備間の連携と施工調整', 'コンベヤ、除塵機、配管など異なる設備間の設計連携が必要なプロジェクトで、各設備のインターフェース設計やレイアウト調整はどのように統一して進めるべきでしょうか？', '設計連携,施工調整,インターフェース', '2024-03-05'),
            (10000009, '施工スケジュールと品質管理の統合運用', '基礎工事、防食塗装、配管工事など複数の工事が同時進行する現場では、施工スケジュールと品質管理をどう一元管理すれば、工程間のトラブルを未然に防げるでしょうか？', 'スケジュール管理,品質管理,施工', '2024-03-10'),
            (10000010, '設計変更時の再調整と記録管理', '設計変更が生じた場合、特に除塵機と配管、あるいは基礎部との連携部分において、再設計や現場調整が必要となります。現場では、こうした変更をどのように記録し、管理しているのでしょうか？', '設計変更,記録管理,施工', '2024-03-15')
        ]
        c.executemany('''
            INSERT INTO questions (ldap_id, title, content, tags, created_at)
            VALUES (?, ?, ?, ?, ?)
        ''', questions)
        
        # 回答データ (各質問に1-3回答)
        answers = [
            (1, 10000003, 'まず、搬送物の重量や流量、ベルトの材質に基づき、メーカー提供の計算式で適正な張力を求めます。設計段階では、ローラーの配置や支持部材の強度計算を十分に行い、振動解析も実施してください。実運転後は、振動センサでデータを取得し、必要に応じたアジャストメントを行う体制を整えると良いです。', '2024-01-12', '2024-01-12'),
            (2, 10000004, 'まず、現場ごとの粉塵発生特性をヒアリングや実測データで把握し、必要な処理能力を算出します。次に、フィルターの捕集効率とダクト内の圧力損失を考慮して、使用するファンの能力を見積もります。CADと流体解析ソフトでシミュレーションを行い、各部のチューニングを実施することが成功の鍵です。', '2024-01-17', '2024-01-17'),
            (3, 10000002, 'まず、現場の汚泥の物性（粘度や含水率）をしっかり把握します。その上で、フライトの角度は汚泥が詰まりにくい斜め方向（一般的には30～45度程度）が多く採用されます。ピッチや刃の形状は、試作やシミュレーションで最適値を見つけ、摩耗に強い材質を選択することがポイントです。現場試験で微調整を繰り返すと良いでしょう。', '2024-01-22', '2024-01-22'),
            (4, 10000001, '配管ルートには必ず膨張ループやフレックスジョイントを取り入れ、熱変形を吸収できる設計とします。また、各部品の素材選定も重要で、温度変化による膨張係数の違いを考慮してください。CAE解析を用いて応力分布をシミュレーションし、局所的な集中を防止する支持金具の配置を行うことが基本です。', '2024-02-07', '2024-02-07'),
            (5, 10000005, '作業者だけではなく、工具や器材も含めた最大荷重を試算し、耐荷重性を確認することが重要です。手すり、足場、滑り止めなどの安全対策は現地の安全基準に準拠します。さらに、非常時の退避経路や定期点検による構造健全性のチェックを計画に含めるようにしましょう。', '2024-02-12', '2024-02-12'),
            (6, 10000007, 'まず、地盤調査を徹底し、適切な基礎形式（布基礎、杭基礎など）を選定します。さらに、振動吸収のために、鋼板スラブの下にゴム材や特殊クッション材を挟む設計を検討するのが一般的です。実際の設計では、動的解析を行い、振動モードや衝撃伝播を予測し、再現実験を経て設計を確定します。', '2024-02-17', '2024-02-17'),
            (7, 10000008, 'まず、サンドブラストなどで既存の錆や汚染物質を徹底的に除去し、適切な下地処理を行います。次に、各層ごとに規定の塗装厚を維持するため、測厚器などで現場検査を実施します。また、施工中の温度、湿度、風速を常にモニタリングし、塗装条件が基準を満たしているか確認する体制を整え、検査記録を詳細に残すことが大切です。', '2024-03-03', '2024-03-03'),
            (8, 10000009, '各設備の設計図面を統一フォーマットに落とし込み、共通のインターフェース基準を設けることが第一歩です。各専門部門間での合同レビューや、3Dモデリングによる干渉チェックが不可欠です。また、プロジェクトマネージャーの下で定期ミーティングを開催し、実際の現場状況を反映した設計変更や調整を迅速に行える体制を構築することが求められます。', '2024-03-07', '2024-03-07'),
            (9, 10000010, 'まずは各工程の詳細な作業計画と品質チェックリストを作成し，全体のタイムラインを統合した進捗管理システムを導入します。各工程の責任者が定期的に現場検査を行い，進捗報告を共有することで，問題の早期発見と迅速な対応が可能となります。また，各工程間のインターフェース部分は，専門の監督者を置き，情報の共有と連携を強化することが重要です。', '2024-03-12', '2024-03-12'),
            (10, 10000006, '設計変更は，まず正式な変更依頼書や影響分析レポートを作成し，関係部署と協議の上で承認を得ます。その後，図面や仕様書はバージョン管理システムに登録し，変更箇所に対するマーキングやコメントを残します。さらに，施工前にプレコンストラクションミーティングを実施し，変更内容とその影響を全体で共有することが必須です。これにより，現場での再調整がスムーズに行えるようになります。', '2024-03-17', '2024-03-17'),
            (1, 10000007, '追加のアドバイスとして，コンベヤの定期的なメンテナンス計画も設計段階で考慮に入れておくことをお勧めします。特に，ベアリングの潤滑管理やベルトの張力調整は，長期的な安定稼働に不可欠です。', '2024-01-18', '2024-01-18'),
            (2, 10000003, '粉塵の性質によっては，静電気対策も重要です。導電性素材の使用や接地設計を検討してください。', '2024-01-25', '2024-01-25'),
            (3, 10000005, 'フライトの摩耗対策としては，表面に硬質クロメート処理を施すか，セラミックライニングを検討すると良いでしょう。', '2024-02-02', '2024-02-02')
        ]
        c.executemany('''
            INSERT INTO answers (question_id, ldap_id, content, posted_at, updated_at)
            VALUES (?, ?, ?, ?, ?)
        ''', answers)
        
        conn.commit()
        print("ダミーデータ生成完了")
        return True
    except Exception as e:
        print(f"ダミーデータ生成エラー: {e}")
        return False
    finally:
        if 'conn' in locals():
            conn.close()

if __name__ == "__main__":
    print("ダミーデータを生成します...")
    if generate_dummy_data():
        print("ダミーデータの生成が完了しました")
    else:
        print("ダミーデータの生成に失敗しました")
